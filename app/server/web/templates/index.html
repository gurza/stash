{{define "content"}}
<div class="header">
    <h1><svg class="logo-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path fill="currentColor" d="M7 12.25h10v-2H7zm0-3.5h10v-2H7zM3 21V3h18v18zm2-2h14v-3h-3q-.75.95-1.787 1.475T12 18t-2.212-.525T8 16H5zm7-3q.95 0 1.725-.55T14.8 14H19V5H5v9h4.2q.3.9 1.075 1.45T12 16m-7 3h14z"/></svg>Stash</h1>
    <div class="header-actions">
        {{if .SecretsEnabled}}
        <button class="filter-button"
                hx-post="{{.BaseURL}}/web/secrets-filter"
                hx-target="#keys-table"
                hx-swap="innerHTML"
                hx-include="[name='search'], [name='page']"
                title="Filter keys">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M22 3H2l8 9.46V19l4 2v-8.54L22 3z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span id="filter-label">{{.SecretsFilter.Label}}</span>
        </button>
        {{end}}
        <button class="sort-button"
                hx-post="{{.BaseURL}}/web/sort"
                hx-target="#keys-table"
                hx-swap="innerHTML"
                hx-include="[name='search'], [name='page']"
                title="Change sort order">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M3 6h18M3 12h12M3 18h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <span id="sort-label">{{.SortMode | sortModeLabel}}</span>
        </button>
        <input type="search"
               name="search"
               placeholder="Search keys..."
               hx-get="{{.BaseURL}}/web/keys"
               hx-trigger="input changed delay:300ms, search"
               hx-target="#keys-table"
               hx-swap="innerHTML"
               class="search-input">
        {{if .CanWrite}}
        <button class="btn btn-primary"
                hx-get="{{.BaseURL}}/web/keys/new"
                hx-target="#modal-content"
                hx-swap="innerHTML">
            + New Key
        </button>
        {{end}}
        <button id="view-mode-btn" class="btn-icon"
                hx-post="{{.BaseURL}}/web/view-mode"
                hx-target="#keys-table"
                hx-swap="innerHTML"
                hx-include="[name='search'], [name='page']"
                title="Toggle view mode">
            <span id="view-mode-icon">{{if eq .ViewMode.String "cards"}}<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M3 6h18M3 12h18M3 18h18"/></svg>{{else}}<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>{{end}}</span>
        </button>
        {{if and .AuditEnabled .IsAdmin}}
        <a href="{{.BaseURL}}/audit" class="btn-icon" title="Audit Log">
            <svg width="18" height="18" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path fill="currentColor" d="M12 21q-3.45 0-6.012-2.287T3.05 13H5.1q.35 2.6 2.313 4.3T12 19q2.925 0 4.963-2.037T19 12t-2.037-4.962T12 5q-1.725 0-3.225.8T6.25 8H9v2H3V4h2v2.35q1.275-1.6 3.113-2.475T12 3q1.875 0 3.513.713t2.85 1.924t1.925 2.85T21 12t-.712 3.513t-1.925 2.85t-2.85 1.925T12 21m2.8-4.8L11 12.4V7h2v4.6l3.2 3.2z"/></svg>
        </a>
        {{end}}
        <form hx-post="{{.BaseURL}}/web/theme" hx-swap="none">
            <button type="submit" class="btn-icon" title="Toggle theme">
                {{if eq .Theme.String "dark"}}
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
                {{else}}
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
                {{end}}
            </button>
        </form>
        {{if .AuthEnabled}}
        <form method="POST" action="{{.BaseURL}}/logout">
            <button type="submit" class="btn-icon" title="Logout">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9"/></svg>
            </button>
        </form>
        {{end}}
    </div>
</div>

<div class="stats">
    <span id="key-count">{{if eq .TotalKeys 0}}no keys{{else}}{{.TotalKeys}} {{if eq .TotalKeys 1}}key{{else}}keys{{end}}{{end}}</span>
    <span id="pagination" class="pagination">
        {{if gt .TotalPages 1}}
        <button class="btn-page{{if not .HasPrev}} disabled{{end}}"
                {{if .HasPrev}}hx-get="{{.BaseURL}}/web/keys?page={{sub .Page 1}}"
                hx-target="#keys-table"
                hx-swap="innerHTML"
                hx-include="[name='search']"{{end}}>&#8249;</button>
        <span class="page-info">{{.Page}} / {{.TotalPages}}</span>
        <button class="btn-page{{if not .HasNext}} disabled{{end}}"
                {{if .HasNext}}hx-get="{{.BaseURL}}/web/keys?page={{add .Page 1}}"
                hx-target="#keys-table"
                hx-swap="innerHTML"
                hx-include="[name='search']"{{end}}>&#8250;</button>
        {{end}}
    </span>
</div>
<input type="hidden" name="page" id="current-page" value="{{.Page}}">

<div class="table-container">
    <div id="keys-table">
        {{template "keys-table" .}}
    </div>
</div>
{{end}}
