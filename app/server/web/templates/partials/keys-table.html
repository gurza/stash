{{define "keys-table"}}
{{if .Keys}}
{{if eq .ViewMode.String "cards"}}
<div class="cards-container">
    {{range .Keys}}
    <div class="key-card"
         hx-get="{{$.BaseURL}}/web/keys/view/{{.Key | urlEncode}}"
         hx-target="#modal-content"
         hx-swap="innerHTML">
        <div class="key-card-header">
            <span class="key-card-name">{{.Key}}{{if .Secret}} <svg class="lock-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>{{end}}{{if .ZKEncrypted}} <svg class="zk-lock-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" title="Zero-Knowledge Encrypted"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="M9 12l2 2 4-4"/></svg>{{end}}</span>
        </div>
        <div class="key-card-meta">
            <span>{{.Size | formatSize}}</span>
            <span>Updated: {{.UpdatedAt | formatTime}}</span>
        </div>
        {{if .CanWrite}}
        <div class="key-card-actions">
            {{if not .ZKEncrypted}}
            <button class="btn btn-edit btn-small"
                    onclick="event.stopPropagation()"
                    hx-get="{{$.BaseURL}}/web/keys/edit/{{.Key | urlEncode}}"
                    hx-target="#modal-content"
                    hx-swap="innerHTML">Edit</button>
            {{end}}
            <button class="btn btn-danger btn-small"
                    onclick="event.stopPropagation(); showConfirmDelete('{{.Key | js}}', '{{$.BaseURL}}/web/keys/{{.Key | urlEncode}}')">Delete</button>
        </div>
        {{end}}
    </div>
    {{end}}
</div>
{{else}}
<table>
    <thead>
        <tr>
            <th>Key</th>
            <th>Size</th>
            <th>Updated</th>
            <th>Created</th>
            {{if $.CanWrite}}<th class="actions-cell">Action</th>{{end}}
        </tr>
    </thead>
    <tbody>
        {{range .Keys}}
        <tr class="clickable-row"
            hx-get="{{$.BaseURL}}/web/keys/view/{{.Key | urlEncode}}"
            hx-target="#modal-content"
            hx-swap="innerHTML"
            hx-trigger="click target:td:not(.actions-cell)">
            <td class="key-cell">{{.Key}}{{if .Secret}} <svg class="lock-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>{{end}}{{if .ZKEncrypted}} <svg class="zk-lock-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" title="Zero-Knowledge Encrypted"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="M9 12l2 2 4-4"/></svg>{{end}}</td>
            <td class="size-cell">{{.Size | formatSize}}</td>
            <td class="date-cell">{{.UpdatedAt | formatTime}}</td>
            <td class="date-cell">{{.CreatedAt | formatTime}}</td>
            {{if $.CanWrite}}
            <td class="actions-cell">
                {{if .CanWrite}}
                {{if not .ZKEncrypted}}
                <button class="btn btn-edit btn-small"
                        hx-get="{{$.BaseURL}}/web/keys/edit/{{.Key | urlEncode}}"
                        hx-target="#modal-content"
                        hx-swap="innerHTML">Edit</button>
                {{end}}
                <button class="btn btn-danger btn-small"
                        onclick="showConfirmDelete('{{.Key | js}}', '{{$.BaseURL}}/web/keys/{{.Key | urlEncode}}')">Delete</button>
                {{end}}
            </td>
            {{end}}
        </tr>
        {{end}}
    </tbody>
</table>
{{end}}
<div style="display:none">
<span id="key-count" hx-swap-oob="innerHTML">{{.TotalKeys}} {{if eq .TotalKeys 1}}key{{else}}keys{{end}}{{if .Search}} matching "{{.Search}}"{{end}}</span>
<span id="sort-label" hx-swap-oob="innerHTML">{{.SortMode | sortModeLabel}}</span>
{{if .SecretsEnabled}}<span id="filter-label" hx-swap-oob="innerHTML">{{.SecretsFilter.Label}}</span>{{end}}
<span id="view-mode-icon" hx-swap-oob="innerHTML">{{if eq .ViewMode.String "cards"}}<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M3 6h18M3 12h18M3 18h18"/></svg>{{else}}<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>{{end}}</span>
<span id="pagination" hx-swap-oob="outerHTML" class="pagination">
    {{if gt .TotalPages 1}}
    <button class="btn-page{{if not .HasPrev}} disabled{{end}}"
            {{if .HasPrev}}hx-get="{{.BaseURL}}/web/keys?page={{sub .Page 1}}"
            hx-target="#keys-table"
            hx-swap="innerHTML"
            hx-include="[name='search']"{{end}}>&#8249;</button>
    <span class="page-info">{{.Page}} / {{.TotalPages}}</span>
    <button class="btn-page{{if not .HasNext}} disabled{{end}}"
            {{if .HasNext}}hx-get="{{.BaseURL}}/web/keys?page={{add .Page 1}}"
            hx-target="#keys-table"
            hx-swap="innerHTML"
            hx-include="[name='search']"{{end}}>&#8250;</button>
    {{end}}
</span>
<input type="hidden" id="current-page" hx-swap-oob="outerHTML" name="page" value="{{.Page}}">
</div>
{{else if .Search}}
<div class="empty-state">
    <p>No keys matching "{{.Search}}"</p>
</div>
<div style="display:none">
<span id="key-count" hx-swap-oob="innerHTML">no keys matching "{{.Search}}"</span>
<span id="sort-label" hx-swap-oob="innerHTML">{{.SortMode | sortModeLabel}}</span>
{{if .SecretsEnabled}}<span id="filter-label" hx-swap-oob="innerHTML">{{.SecretsFilter.Label}}</span>{{end}}
<span id="view-mode-icon" hx-swap-oob="innerHTML">{{if eq .ViewMode.String "cards"}}<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M3 6h18M3 12h18M3 18h18"/></svg>{{else}}<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>{{end}}</span>
<span id="pagination" hx-swap-oob="outerHTML" class="pagination"></span>
<input type="hidden" id="current-page" hx-swap-oob="outerHTML" name="page" value="1">
</div>
{{else}}
<div class="empty-state">
    <p>No keys stored yet</p>
    {{if .CanWrite}}
    <button class="btn btn-primary"
            hx-get="{{.BaseURL}}/web/keys/new"
            hx-target="#modal-content"
            hx-swap="innerHTML">
        Create your first key
    </button>
    {{end}}
</div>
<div style="display:none">
<span id="key-count" hx-swap-oob="innerHTML">no keys</span>
<span id="sort-label" hx-swap-oob="innerHTML">{{.SortMode | sortModeLabel}}</span>
{{if .SecretsEnabled}}<span id="filter-label" hx-swap-oob="innerHTML">{{.SecretsFilter.Label}}</span>{{end}}
<span id="view-mode-icon" hx-swap-oob="innerHTML">{{if eq .ViewMode.String "cards"}}<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M3 6h18M3 12h18M3 18h18"/></svg>{{else}}<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>{{end}}</span>
<span id="pagination" hx-swap-oob="outerHTML" class="pagination"></span>
<input type="hidden" id="current-page" hx-swap-oob="outerHTML" name="page" value="1">
</div>
{{end}}
{{end}}
